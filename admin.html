<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Admin • Free Fire Tournaments</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary:   #F8FAFC;
      --bg-secondary: #E2E8F0;
      --text-dark:    #1E293B;
      --accent-blue:  #2563EB;
      --accent-gold:  #FBBF24;
      --accent-red:   #DC2626;
      --border:       #CBD5E1;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; height:100%; background:var(--bg-primary); color:var(--text-dark); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .brand { font-family: 'Russo One', Inter, system-ui; letter-spacing: 0.5px; }
    .app { display:flex; min-height:100dvh; }
    .sidebar { width: 84px; background:white; border-right:1px solid var(--border); display:flex; flex-direction: column; align-items:center; padding: 10px 8px; gap:8px; position: sticky; top:0; height: 100dvh; }
    .nav-btn { width:100%; border:none; background:transparent; padding:10px 6px; border-radius:12px; color:#334155; display:flex; flex-direction: column; align-items:center; gap:6px; cursor:pointer; }
    .nav-btn.active { background: var(--bg-secondary); color: var(--accent-blue); }
    .content { flex:1; display:flex; flex-direction: column; }
    header { position: sticky; top:0; z-index:20; background:var(--bg-primary); border-bottom:1px solid var(--border); padding: 10px 12px; display:flex; justify-content: space-between; align-items:center; }
    .btn { padding: 10px 12px; border:none; border-radius: 12px; background: var(--accent-blue); color:white; cursor:pointer; }
    .btn.ghost { background: transparent; color: var(--accent-blue); border:1px solid var(--accent-blue); }
    .grid { padding: 12px; display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 800px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    .card { background:white; border:1px solid var(--border); border-radius: var(--radius); padding: 12px; }
    .metric { display:flex; align-items:center; justify-content: space-between; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding: 10px; border-bottom:1px solid var(--border); text-align:left; font-size: 13px; }
    .toolbar { display:flex; gap:8px; flex-wrap: wrap; }
    .input { width:100%; padding:10px 12px; border-radius: 12px; border:1px solid var(--border); background:white; }
    .section-title { display:flex; justify-content: space-between; align-items:center; margin-bottom: 6px; }
    .chips { display:flex; gap:8px; flex-wrap: wrap; }
    .chip { padding:6px 8px; background:var(--bg-secondary); border-radius:999px; cursor:pointer; }
    .chip.active { background:var(--accent-blue); color:white; }
    .modal-backdrop { position: fixed; inset:0; background: rgba(15,23,42,.45); display:none; align-items:center; justify-content:center; padding: 16px; }
    .modal { width:100%; max-width: 560px; background:white; border-radius:16px; border:1px solid var(--border); padding: 12px; }
    .modal .row { display:flex; gap:8px; }
    .modal .col { flex:1; }
    .modal-actions { display:flex; justify-content:flex-end; gap:8px; margin-top:8px; }
    .chart { height: 180px; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <button class="nav-btn active" data-page="dashboard">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M3 3h8v8H3zM13 3h8v5h-8zM13 10h8v11h-8zM3 13h8v8H3z" fill="currentColor"/></svg>
        <small>Dashboard</small>
      </button>
      <button class="nav-btn" data-page="tournaments">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M4 4h16v3H4zM6 9h12l-1 11H7L6 9z" fill="currentColor"/></svg>
        <small>Tournaments</small>
      </button>
      <button class="nav-btn" data-page="players">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 2a5 5 0 110 10 5 5 0 010-10zm0 12c-4.4 0-8 2.2-8 6v2h16v-2c0-3.8-3.6-6-8-6z" fill="currentColor"/></svg>
        <small>Players</small>
      </button>
      <button class="nav-btn" data-page="analytics">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M4 13h3v8H4zM10 9h3v12h-3zM16 5h3v16h-3z" fill="currentColor"/></svg>
        <small>Analytics</small>
      </button>
      <button class="nav-btn" data-page="settings">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M19.14 12.94a7 7 0 11-14.28 0 7 7 0 0114.28 0z" stroke="currentColor" fill="none"/></svg>
        <small>Settings</small>
      </button>
    </aside>
    <div class="content">
      <header>
        <div class="brand" style="display:flex;align-items:center;gap:8px;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2l3 6 6 .9-4.5 4.4 1 6.3L12 16l-5.5 3.6 1-6.3L3 8.9 9 8l3-6z" fill="currentColor"/></svg>
          <span>Admin</span>
        </div>
        <div class="toolbar">
          <button class="btn" id="btnCreateTourn">Create Tournament</button>
          <button class="btn ghost">View Payments</button>
          <button class="btn ghost">Send Notification</button>
        </div>
      </header>

      <!-- Pages -->
      <div id="page-dashboard" class="grid">
        <div class="card metric">
          <div><div>Total Tournaments</div><div class="brand" style="font-size:24px;" id="mTournaments">0</div></div>
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M4 4h16v3H4zM6 9h12l-1 11H7L6 9z" fill="#2563EB"/></svg>
        </div>
        <div class="card metric">
          <div><div>Total Players</div><div class="brand" style="font-size:24px;" id="mPlayers">0</div></div>
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M12 2a5 5 0 110 10 5 5 0 010-10z" fill="#2563EB"/></svg>
        </div>
        <div class="card metric">
          <div><div>Online Players</div><div class="brand" style="font-size:24px;" id="mOnline">0</div></div>
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M4 13h3v8H4zM10 9h3v12h-3zM16 5h3v16h-3z" fill="#22C55E"/></svg>
        </div>
        <div class="card metric">
          <div><div>Wallet Balance Held</div><div class="brand" style="font-size:24px;" id="mWallet">₹0</div></div>
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M3 7h18v10H3z" fill="#F59E0B"/></svg>
        </div>

        <div class="card" style="grid-column: 1/-1;">
          <div class="section-title"><h3 class="brand" style="margin:0;">Activity</h3></div>
          <div class="chart" id="chartActivity"></div>
        </div>
      </div>

      <div id="page-tournaments" class="grid" style="display:none;">
        <div class="card" style="grid-column:1/-1;">
          <div class="section-title">
            <h3 class="brand" style="margin:0;">Tournaments</h3>
            <div class="chips">
              <div class="chip active" data-filter="all">All</div>
              <div class="chip" data-filter="live">Live</div>
              <div class="chip" data-filter="upcoming">Upcoming</div>
              <div class="chip" data-filter="past">Past</div>
            </div>
          </div>
          <div class="toolbar" style="margin-bottom:8px;">
            <input class="input" id="tSearch" placeholder="Search by title/map" style="flex:1;" />
            <button class="btn" id="btnQuickCreate">Quick Create</button>
          </div>
          <div style="overflow:auto;">
            <table class="table" id="tTable">
              <thead>
                <tr><th>Title</th><th>Time</th><th>Map</th><th>Prize</th><th>Entry</th><th>Players</th><th>Status</th><th>Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="page-players" class="grid" style="display:none;">
        <div class="card">
          <div class="section-title"><h3 class="brand" style="margin:0;">Players</h3></div>
          <input class="input" id="pSearch" placeholder="Search name/UID/email" />
          <div id="playersList" style="margin-top:8px; display:grid; grid-template-columns:1fr; gap:10px;"></div>
        </div>
      </div>

      <div id="page-analytics" class="grid" style="display:none;">
        <div class="card"><div class="section-title"><h3 class="brand" style="margin:0;">Daily Sign-ups</h3></div><div class="chart" id="chartSignups"></div></div>
        <div class="card"><div class="section-title"><h3 class="brand" style="margin:0;">Revenue</h3></div><div class="chart" id="chartRevenue"></div></div>
        <div class="card"><div class="section-title"><h3 class="brand" style="margin:0;">Referrals Redeemed</h3></div><div class="chart" id="chartReferrals"></div></div>
        <div class="card"><div class="section-title"><h3 class="brand" style="margin:0;">Active Players</h3></div><div class="chart" id="gaugeActive"></div></div>
      </div>

      <div id="page-settings" class="grid" style="display:none;">
        <div class="card">
          <div class="section-title"><h3 class="brand" style="margin:0;">Payment Gateway</h3></div>
          <div class="modal row" style="box-shadow:none;border:none;padding:0;background:transparent;">
            <div class="col">
              <label>Razorpay Key</label>
              <input class="input" placeholder="rzp_live_xxx" />
            </div>
            <div class="col">
              <label>Stripe Publishable Key</label>
              <input class="input" placeholder="pk_live_xxx" />
            </div>
          </div>
        </div>
        <div class="card">
          <div class="section-title"><h3 class="brand" style="margin:0;">Referral Rules</h3></div>
          <div class="row">
            <div class="col"><label>Signup Bonus (₹)</label><input class="input" value="10" /></div>
            <div class="col"><label>Per Referral (₹)</label><input class="input" value="5" /></div>
          </div>
        </div>
        <div class="card">
          <div class="section-title"><h3 class="brand" style="margin:0;">Admin Users</h3></div>
          <div style="display:grid; gap:8px;">
            <div class="card" style="padding:8px; display:flex; justify-content:space-between; align-items:center;">
              <div style="display:flex; align-items:center; gap:8px;">
                <img src="https://api.dicebear.com/7.x/thumbs/svg?seed=admin" width="36" height="36" style="border-radius:8px;border:1px solid var(--border);"/>
                <div>Owner</div>
              </div>
              <button class="btn ghost">Manage</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Create/Edit Tournament Modal -->
  <div class="modal-backdrop" id="modalTourn">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 class="brand" style="margin:0 0 8px;">Create / Edit Tournament</h3>
      <div class="row" style="margin-bottom:8px;">
        <div class="col"><label>Title</label><input class="input" id="fTitle" /></div>
      </div>
      <div class="row" style="margin-bottom:8px;">
        <div class="col"><label>Date/Time</label><input class="input" id="fTime" type="datetime-local" /></div>
        <div class="col"><label>Map</label><input class="input" id="fMap" placeholder="Bermuda" /></div>
      </div>
      <div class="row" style="margin-bottom:8px;">
        <div class="col"><label>Prize (₹)</label><input class="input" id="fPrize" type="number" value="1000" /></div>
        <div class="col"><label>Entry Fee (₹)</label><input class="input" id="fEntry" type="number" value="20" /></div>
      </div>
      <div class="row" style="margin-bottom:8px;">
        <div class="col"><label>Room ID</label><input class="input" id="fRoomId" /></div>
        <div class="col"><label>Room Pass</label><input class="input" id="fRoomPass" /></div>
        <div class="col"><label>Max Players</label><input class="input" id="fMax" type="number" value="100" /></div>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" data-close="modalTourn">Cancel</button>
        <button class="btn" id="btnSaveTourn">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase / Firestore placeholder
    // const firebaseConfig = {};
    // firebase.initializeApp(firebaseConfig);
    // const db = firebase.firestore();

    const state = {
      tournaments: [
        { id:'t1', status:'live', title:'Bermuda Blitz', matchTime:'2025-07-20T19:00', map:'Bermuda', prize:1000, entryFee:20, playersJoined:64, maxPlayers:100 },
        { id:'t2', status:'upcoming', title:'Purgatory Pro', matchTime:'2025-07-21T18:00', map:'Purgatory', prize:2000, entryFee:40, playersJoined:0, maxPlayers:100 },
        { id:'t3', status:'past', title:'Island Finals', matchTime:'2025-07-18T20:00', map:'Kalahari', prize:5000, entryFee:50, playersJoined:100, maxPlayers:100 },
      ],
      players: [
        { id:'u1', name:'Rohan', uid:'987654321', email:'rohan@example.com', referrals:2, wallet:240 },
        { id:'u2', name:'Aisha', uid:'123456789', email:'aisha@example.com', referrals:4, wallet:120 },
      ]
    };

    function el(q){ return document.querySelector(q); }
    function els(q){ return Array.from(document.querySelectorAll(q)); }

    // Navigation
    els('.nav-btn').forEach(btn => btn.addEventListener('click', ()=>{
      els('.nav-btn').forEach(b=> b.classList.remove('active'));
      btn.classList.add('active');
      const pg = btn.dataset.page;
      ['dashboard','tournaments','players','analytics','settings'].forEach(p=>{
        el('#page-'+p).style.display = (p===pg) ? '' : 'none';
      });
    }));

    // Dashboard metrics
    function renderMetrics(){
      el('#mTournaments').textContent = state.tournaments.length;
      el('#mPlayers').textContent = state.players.length;
      el('#mOnline').textContent = Math.floor(state.players.length * 0.4);
      const walletHeld = state.tournaments.reduce((sum,t)=> sum + (t.entryFee * t.playersJoined), 0);
      el('#mWallet').textContent = '₹' + walletHeld;
    }

    // Tournaments table
    function renderTournaments(filter='all', query=''){
      const tbody = el('#tTable tbody');
      tbody.innerHTML = '';
      const list = state.tournaments.filter(t=> (filter==='all'||t.status===filter) && (t.title.toLowerCase().includes(query)||t.map.toLowerCase().includes(query)));
      for (const t of list){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.title}</td><td>${new Date(t.matchTime).toLocaleString()}</td><td>${t.map}</td><td>₹${t.prize}</td><td>₹${t.entryFee}</td><td>${t.playersJoined}/${t.maxPlayers}</td><td>${t.status}</td><td>
          <button class="btn ghost" data-edit="${t.id}">Edit</button>
          <button class="btn ghost" data-toggle="${t.id}">${t.status==='past'?'Delete':'Toggle'}</button>
        </td>`;
        tbody.appendChild(tr);
      }
    }

    // Players list
    function renderPlayers(query=''){
      const list = el('#playersList');
      list.innerHTML = '';
      for (const p of state.players.filter(p=> (p.name+p.uid+p.email).toLowerCase().includes(query))){
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<div style="display:flex; align-items:center; gap:10px;">
          <img src="https://api.dicebear.com/7.x/thumbs/svg?seed=${encodeURIComponent(p.name)}" width="40" height="40" style="border-radius:10px;border:1px solid var(--border);"/>
          <div style="flex:1;">
            <div class="brand" style="font-size:14px;">${p.name}</div>
            <div style="font-size:12px;color:#334155;">UID: ${p.uid} • ${p.email}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:12px;">Referrals: ${p.referrals}</div>
            <div style="font-size:12px;">Wallet: ₹${p.wallet}</div>
          </div>
        </div>`;
        list.appendChild(card);
      }
    }

    // Filters & search
    els('.chip').forEach(ch => ch.addEventListener('click', ()=>{
      els('.chip').forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');
      renderTournaments(ch.dataset.filter, el('#tSearch').value.trim().toLowerCase());
    }));
    el('#tSearch').addEventListener('input', ()=> renderTournaments(els('.chip.active')[0].dataset.filter, el('#tSearch').value.trim().toLowerCase()));
    el('#pSearch').addEventListener('input', ()=> renderPlayers(el('#pSearch').value.trim().toLowerCase()));

    // Modal helpers
    function openModal(id){ const m = document.getElementById(id); if(!m) return; m.style.display='flex'; }
    function closeModal(id){ const m = document.getElementById(id); if(!m) return; m.style.display='none'; }
    els('[data-close]').forEach(b=> b.addEventListener('click', ()=> closeModal(b.getAttribute('data-close'))));

    // Create/Edit tournament
    el('#btnCreateTourn').addEventListener('click', ()=> {
      el('#fTitle').value=''; el('#fTime').value=''; el('#fMap').value='Bermuda'; el('#fPrize').value=1000; el('#fEntry').value=20; el('#fRoomId').value=''; el('#fRoomPass').value=''; el('#fMax').value=100;
      openModal('modalTourn');
    });
    el('#btnQuickCreate').addEventListener('click', ()=> el('#btnCreateTourn').click());
    document.addEventListener('click', (e)=>{
      const ed = e.target.closest('[data-edit]');
      if (ed){
        const t = state.tournaments.find(x=> x.id===ed.getAttribute('data-edit'));
        if (!t) return;
        el('#fTitle').value=t.title; el('#fTime').value=t.matchTime; el('#fMap').value=t.map; el('#fPrize').value=t.prize; el('#fEntry').value=t.entryFee; el('#fRoomId').value=t.roomId||''; el('#fRoomPass').value=t.roomPass||''; el('#fMax').value=t.maxPlayers;
        openModal('modalTourn');
      }
      const tg = e.target.closest('[data-toggle]');
      if (tg){
        const id = tg.getAttribute('data-toggle');
        const t = state.tournaments.find(x=> x.id===id);
        if (!t) return;
        if (t.status==='past') {
          state.tournaments = state.tournaments.filter(x=> x.id!==id);
        } else {
          t.status = (t.status==='live')? 'upcoming' : 'live';
        }
        renderTournaments(els('.chip.active')[0].dataset.filter, el('#tSearch').value.trim().toLowerCase());
        renderMetrics();
      }
    });
    el('#btnSaveTourn').addEventListener('click', ()=>{
      const obj = {
        id: 't' + Math.random().toString(36).slice(2,7),
        status: 'upcoming',
        title: el('#fTitle').value.trim()||'Untitled',
        matchTime: el('#fTime').value||new Date().toISOString(),
        map: el('#fMap').value||'Bermuda',
        prize: parseInt(el('#fPrize').value||'0',10),
        entryFee: parseInt(el('#fEntry').value||'0',10),
        roomId: el('#fRoomId').value, roomPass: el('#fRoomPass').value,
        maxPlayers: parseInt(el('#fMax').value||'100',10), playersJoined: 0
      };
      state.tournaments.unshift(obj);
      // Firestore placeholder:
      // await db.collection('tournaments').doc(obj.id).set(obj, { merge: true });
      closeModal('modalTourn');
      renderTournaments(els('.chip.active')[0].dataset.filter, el('#tSearch').value.trim().toLowerCase());
      renderMetrics();
    });

    // Simple charts (SVG inline) – lightweight
    function miniBars(containerId, values, color){
      const w = 320, h = 160, pad = 16; const max = Math.max(...values, 1);
      const bw = (w - pad*2) / values.length;
      let svg = `<svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">`;
      values.forEach((v,i)=>{
        const bh = (v/max) * (h - pad*2);
        const x = pad + i*bw + 2; const y = h - pad - bh;
        svg += `<rect x="${x}" y="${y}" width="${bw-4}" height="${bh}" rx="6" fill="${color}"/>`;
      });
      svg += `</svg>`; el('#'+containerId).innerHTML = svg;
    }
    function gauge(containerId, value){
      const w = 320, h = 160; const cx = w/2, cy = h; const r = 120; const pct = Math.max(0, Math.min(1, value));
      const ang = Math.PI * (1 + pct); const x = cx + r*Math.cos(ang); const y = cy + r*Math.sin(ang);
      const large = pct>0.5 ? 1:0;
      const path = `M ${cx-r} ${cy} A ${r} ${r} 0 ${large} 1 ${x} ${y}`;
      const needle = `M ${cx} ${cy} L ${cx} ${cy-6} L ${x} ${y} Z`;
      el('#'+containerId).innerHTML = `<svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
        <path d="${path}" stroke="#CBD5E1" stroke-width="14" fill="none" stroke-linecap="round" />
        <path d="${path}" stroke="#2563EB" stroke-width="10" fill="none" stroke-dasharray="400" stroke-dashoffset="${400*(1-pct)}" />
        <path d="${needle}" fill="#DC2626" />
      </svg>`;
    }

    function renderCharts(){
      miniBars('chartActivity', [4,7,3,8,5,9,6], '#6366F1');
      miniBars('chartSignups', [2,4,3,6,8,5,9], '#22C55E');
      miniBars('chartRevenue', [200,500,300,900,700,1100,800], '#F59E0B');
      miniBars('chartReferrals', [1,2,1,3,2,4,3], '#0EA5E9');
      gauge('gaugeActive', 0.62);
    }

    function init(){
      renderMetrics();
      renderTournaments();
      renderPlayers();
      renderCharts();
    }
    init();
  </script>
</body>
</html>

